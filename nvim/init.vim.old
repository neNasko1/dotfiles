call plug#begin('~/.vim/plugged')
	Plug 'nvim-lua/plenary.nvim'
	Plug 'nvim-telescope/telescope.nvim'

	Plug 'airblade/vim-gitgutter'
	Plug 'tpope/vim-fugitive'
	Plug 'tpope/vim-rhubarb'

	Plug 'williamboman/mason.nvim'
	Plug 'williamboman/mason-lspconfig.nvim'
	Plug 'VonHeikemen/lsp-zero.nvim'
	Plug 'neovim/nvim-lspconfig'

	Plug 'prabirshrestha/vim-lsp'

	Plug 'jacoborus/tender.vim'
	Plug 'pineapplegiant/spaceduck', { 'branch': 'main' }
call plug#end()

set smartindent autoindent smarttab cindent
set tabstop=4
set shiftwidth=4
set relativenumber
set number
set nowrap
set noswapfile
set langmap=чявертъуиопшщасдфгхйклзьцжбнмЧЯВЕРТЪУИОПШЩАСДФГХЙКЛЗѝЦЖБНМ;`qwertyuiop[]asdfghjklzxcvbnm~QWERTYUIOP{}ASDFGHJKLZXCVBNM
set clipboard+=unnamedplus
syntax on

if has('mouse')
    set mouse=a
endif

" Make copy pasting consistent with my understanding of how deletion works
nnoremap dd "_dd
vnoremap d "_d
noremap p "_"+p
noremap P "_"+P

autocmd Syntax * syn match ExtraWhitespace /\s\+$\| \+\ze\t/
autocmd BufWritePre * :%s/\s\+$//e
highlight TrailingWhitespaces ctermbg=red
match TrailingWhitespaces /\s\s*$/

" Theme
if (has("termguicolors"))
	let &t_8f = "\<Esc>[38;2;%lu;%lu;%lum"
	let &t_8b = "\<Esc>[48;2;%lu;%lu;%lum"
	set termguicolors
endif

let $NVIM_TUI_ENABLE_TRUE_COLOR=1

syntax enable
colorscheme tender
" Theme

" Vim-lsp
nnoremap <silent> gd <cmd>lua vim.lsp.buf.definition()<CR>
nnoremap <silent> gD <cmd>lua vim.lsp.buf.declaration()<CR>

lua <<EOF
local opts = { noremap=true, silent=true }
vim.keymap.set('n', '[d', vim.diagnostic.goto_prev, opts)
vim.keymap.set('n', ']d', vim.diagnostic.goto_next, opts)

local lsp_zero = require('lsp-zero')
local lspconfig = require("lspconfig")
local servers = { 'lua_ls', 'rust_analyzer', 'pyright', 'bashls', 'clangd', 'typst_lsp' }

require('mason').setup({})
require('mason-lspconfig').setup({ ensure_installed = servers })

local on_attach = function(client, bufnr)
	-- Enable completion triggered by <c-x><c-o>
	vim.api.nvim_buf_set_option(bufnr, 'omnifunc', 'v:lua.vim.lsp.omnifunc')

	local bufopts = { noremap=true, silent=true, buffer=bufnr }
	vim.keymap.set('n', 'gd', vim.lsp.buf.definition, bufopts)
	vim.keymap.set('n', 'gi', vim.lsp.buf.implementation, bufopts)
	vim.keymap.set('n', 'ff', vim.lsp.buf.code_action, bufopts)
	vim.keymap.set('n', 'K', vim.lsp.buf.hover, bufopts)
end

for _, lsp in ipairs(servers) do
	lspconfig[lsp].setup{on_attach = on_attach}
end

EOF
" Vim-lsp

" Telescope
let mapleader=' '
let maplocalleader='/'
nnoremap <leader>p :Telescope git_files<cr>
nnoremap <leader>g :Telescope live_grep<cr>
nnoremap <leader>x :Telescope keymaps<cr>
" Telescope

